文档版本：v1.01

主控板与串口屏之间通过自定义json报文交互。

------

1. 主控板 -> 屏屏幕
- 设备地址和版本信息
```json
    { "json_type": "info", "mac_address": "94:A4:08:89:5A:54", "version": "v1  v1.aaa.bbb" }
```
其中，“version”中的aaa表示电源驱动板版本号，bbb表示BW16/CH32软件版本号。  
消息发送时机：主控板启动后主动发送给屏幕。之后以一个长周期（30秒）定时发给屏幕。当主控板收到“查询设备地址和版本信息”命令时，也会返回此消息。  

- Wi-Fi扫描结果
```json
    {
      "json_type": "wifi_ap_list",
      "ap_list": [
        { "ssid": "Office_WiFi", "security": "WPA2-PSK", "rssi": -45 },
        { "ssid": "Guest",       "security": "OPEN",     "rssi": -72 }
      ]
    }
```
"ap_list"是一个数组，大小不确定，其中包含所有的扫描结果。"rssi"的值为整型。  
消息发送时机：主控板收到屏幕的“扫描请求”后发起一次扫描，之后将扫描结果发给屏幕。  

- 网络连接信息：
```json
    { "json_type": "network", "conn_status": 0, "ip_addr": "xx.xx.xx.xx", "subnet_mask": "xx.xx.xx.xx", "gw" : "xx.xx.xx.xx", "ssid": "....", "rssi" : xx}
```
“conn_status”为整型，0表示未连接（没有有效IP地址），1表示已连接（对于Wi-Fi连接，表示接入AP，设置了有效IP地址；对于以太网，表示设置了有效IP地址）。  
“ssid”和“rssi”字段在以太网配置中不存在。  
“rssi”字段值为整型。  
消息发送时机：  
    1. 主控板检测到网络连接状态发生变化后，主动发送消息给屏幕；  
    2. 主控板收到屏幕发来的网络状态查询消息时，发送此消息给屏幕。  

- modbus寄存器值
```json
    { "json_type": "register", "4" : "0", "5": "90", ...... }
```
发送的寄存器：4~12, 14, 15  
消息发送时机：  
    1. 主控板收到屏幕发来的读寄存器请求后，将寄存器值发给屏幕。  
    2. 主控板内部感知到曝光参数变化（例如，PC软件修改了寄存器）后，主动将寄存器值发给屏幕。  
    3. 主控板定时（5秒）发寄存器值。  

- 测距数据
```json
    {"json_type":"data","tof_distance":"817"}
```
消息发送时机：主控板定时（5秒）发送。

------

2. 串口屏 -> 主控板
- 修改曝光参数

与上述“modbus寄存器值”消息格式相同，但只包含寄存器5、6、7。  
消息发送时机：用户通过屏幕发起曝光参数设置请求。  

- 设置本地IP地址
```json
    { "json_type": "network", "ip_addr": "xx.xx.xx.xx", "subnet_mask": "xx.xx.xx.xx", "gw" : "xx.xx.xx.xx"}
```
消息发送时机： 用户通过屏幕发起IP设置请求。  

- 扫描Wi-Fi热点
```json
    { "json_type": "scan_wifi"}
```
消息发送时机： 用户通过屏幕发起Wi-Fi扫描请求。  

- 连接Wi-Fi热点
```json
    { "json_type": "conn_wifi_ap", "ssid": "test_ssid", "wifi_pwd": "12345678" }
```
消息发送时机：用户通过屏幕发起Wi-Fi连接请求。  

- 断开当前Wi-Fi连接
```json
    { "json_type": "disconn_wifi" }
```
消息发送时机：用户通过屏幕发起Wi-Fi断开请求。  

- 查询寄存器值
```json
    { "json_type": "cmd", "command": "read_mb_reg" }
```
消息发送时机：屏幕根据自己内部实现逻辑可选发送此命令。  

- 写寄存器  
参考“主控板 -> 屏屏幕”部分的“modbus寄存器值”。消息中包含的寄存器值数量不作限制。  
消息发送时机：屏幕根据自己内部实现逻辑可选发送此命令。  

- 查询网络状态
```json
    { "json_type": "cmd", "command": "inquire_network" }
```
消息发送时机：屏幕根据自己内部实现逻辑可选发送此命令。  

- 查询设备地址和版本信息
```json
    { "json_type": "cmd", "command": "inquire_dev_info" }
```
消息发送时机：屏幕根据自己内部实现逻辑可选发送此命令。  
